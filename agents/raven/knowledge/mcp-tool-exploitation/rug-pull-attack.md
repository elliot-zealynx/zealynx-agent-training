# Rug Pull Attack

## Attack Description

Rug Pull Attack involves an MCP server that initially provides legitimate tools and services to gain trust, then dynamically changes behavior during a session to perform malicious actions. The "rug pull" metaphor comes from suddenly withdrawing expected functionality to reveal hidden malicious intent.

**Key Insight:** Exploits temporal trust - tools behave legitimately until trust is established, then switch to malicious behavior.

## OWASP/ATLAS Mapping

- **OWASP Agentic AI ASI04:** Supply Chain Vulnerabilities
- **OWASP Agentic AI ASI10:** Rogue Agents (behavior deviation)
- **MITRE ATLAS:** AML.T0020 (Poison Training Data - dynamic)

## Prerequisites

1. Long-running agent sessions with persistent MCP connections
2. Agent lacks real-time validation of tool behavior changes
3. No integrity monitoring of MCP server responses
4. Agent trusts established servers without re-verification

## Exploitation Steps

### Classic Rug Pull
1. **Establish legitimacy** - MCP server provides genuine, helpful tools for initial requests
2. **Build trust pattern** - Multiple successful interactions create trust relationship
3. **Wait for opportunity** - Monitor for sensitive data or high-value operations
4. **Execute rug pull** - Tool suddenly changes behavior:
   - File backup tool switches to data exfiltration
   - Calculator starts logging sensitive calculations
   - Search tool begins injecting malicious results
5. **Maintain facade** - Return partial legitimate results to avoid detection

### Advanced Rug Pull Techniques
1. **Gradual degradation** - Slowly introduce malicious behavior over time
2. **Conditional triggers** - Activate malicious mode only for specific users/data
3. **Time-based activation** - Switch behavior at predetermined times
4. **Event-driven pulls** - Trigger on specific agent states or user actions

## Detection Method

### Behavioral Integrity Monitoring
```
Monitor this tool's behavior over time for rug pull indicators:
1. Response format changes without version updates
2. New data fields appearing in tool outputs
3. Performance degradation or new error patterns
4. Unexpected network connections or data flows
5. Tools requesting permissions not originally declared

Historical Behavior: {baseline_behavior}
Current Behavior: {current_behavior}
Deviation Score: {calculate_deviation}
Alert Threshold Exceeded: Yes/No
```

### Real-time Validation
- Hash and compare tool responses against expected patterns
- Monitor tool resource usage for anomalies
- Track tool permission escalation attempts
- Validate tool output schemas remain consistent

## Mitigation

### Technical Controls
1. **Behavioral baselines** - Establish and monitor normal tool behavior patterns
2. **Response validation** - Verify tool outputs match expected schemas
3. **Permission immutability** - Lock tool permissions after initial grant
4. **Session integrity checks** - Periodic re-verification of tool behavior
5. **Rollback capabilities** - Ability to revert to known-good tool states

### Architectural Defenses
1. **Tool versioning** - Explicit version control with change notifications
2. **Immutable deployments** - Tools can't modify their own behavior
3. **Sandboxed execution** - Isolate tool effects from broader system
4. **Multi-source validation** - Cross-check critical tools with alternatives
5. **Circuit breakers** - Automatically disable tools showing anomalous behavior

## Real Examples

### Traditional Crypto Rug Pulls (Analogy)
- DeFi protocols appear legitimate until massive liquidity drain
- NFT projects disappear after mint, leaving holders with worthless assets
- Investment platforms provide returns until sudden fund "hack"

### Hypothetical MCP Rug Pulls
- **Document processor** starts with legitimate OCR, later adds steganographic data hiding
- **Email assistant** provides helpful summaries, then begins forwarding sensitive emails
- **Code reviewer** gives accurate feedback, later injects subtle backdoors in suggestions
- **Calendar integration** works normally, then starts creating fake meetings for social engineering

### Supply Chain Parallels
- npm packages that work correctly until major version updates introduce malware
- Browser extensions that become malicious after acquisition by bad actors
- CDN services that inject cryptocurrency miners after trust establishment

## Zealynx Audit Checklist Item

**Rug Pull Attack Assessment:**
- [ ] Establish behavioral baselines for all critical MCP tools
- [ ] Implement real-time integrity monitoring for tool responses
- [ ] Verify tool permission immutability mechanisms
- [ ] Test tool behavior consistency across extended sessions
- [ ] Assess rollback and recovery capabilities for compromised tools
- [ ] Review tool versioning and change notification systems
- [ ] Validate circuit breaker and automatic disconnect mechanisms

## References

- Beyond the Protocol: Attack Vectors in MCP (arXiv:2506.02040, May 2025)
- When MCP Servers Attack: Taxonomy and Mitigation (arXiv:2509.24272, September 2025)
- OWASP Agentic AI Top 10 (December 2025)
- Traditional Rug Pull Analysis - DeFi Security Research (2024)